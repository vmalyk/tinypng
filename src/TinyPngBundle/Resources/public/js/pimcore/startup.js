/** global: pimcore */
pimcore.registerNS("pimcore.plugin.TinyPngBundle");

pimcore.plugin.TinyPngBundle = Class.create(pimcore.plugin.admin, {
    getClassName: function () {
        return "pimcore.plugin.TinyPngBundle";
    },

    initialize: function () {
        pimcore.plugin.broker.registerPlugin(this);

        this.navEl = Ext.get('pimcore_menu_search').insertSibling('<li id="pimcore_menu_tinypng" data-menu-tooltip="Tiny PNG" class="pimcore_menu_item pimcore_menu_needs_children">' +
            '<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="144.000000pt" height="144.000000pt" viewBox="0 0 144.000000 144.000000" preserveAspectRatio="xMidYMid meet"> <g transform="translate(0.000000,144.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"> <path d="M935 1267 c-22 -12 -48 -21 -57 -19 -30 6 -20 -15 27 -60 43 -42 73 -96 81 -148 9 -50 45 -160 53 -160 5 0 -2 35 -14 78 -24 82 -24 92 4 92 27 0 71 61 71 99 0 41 -31 92 -65 108 -19 9 -35 20 -35 25 0 14 -24 9 -65 -15z"/> <path d="M520 1240 c0 -5 5 -10 10 -10 6 0 10 5 10 10 0 6 -4 10 -10 10 -5 0 -10 -4 -10 -10z"/> <path d="M200 1153 c-30 -8 -60 -19 -66 -24 -7 -6 -12 -42 -12 -90 l-1 -79 39 -25 c22 -14 44 -25 49 -25 6 0 14 -8 20 -17 8 -16 11 -15 20 10 6 16 11 43 11 60 0 47 17 100 45 141 14 20 25 38 25 40 0 5 -61 26 -69 25 -3 -1 -31 -8 -61 -16z"/> <path d="M758 1043 c-20 -5 -42 -55 -34 -80 3 -10 20 -26 38 -36 28 -16 33 -16 46 -3 21 21 -2 49 -36 43 -22 -4 -23 -3 -8 12 30 29 81 -23 58 -59 -11 -18 -9 -21 14 -31 15 -5 47 -7 72 -3 44 7 45 7 21 20 -13 7 -50 42 -83 78 -32 36 -61 65 -65 65 -3 -1 -13 -3 -23 -6z"/> <path d="M473 1009 c-27 -10 -36 -27 -58 -109 -10 -37 -28 -75 -41 -88 -34 -32 -31 -45 8 -37 75 17 178 109 178 160 0 56 -41 91 -87 74z m61 -78 c3 -5 -1 -12 -10 -15 -8 -3 -12 -2 -9 4 9 14 -9 12 -23 -2 -16 -16 -15 -45 1 -51 9 -4 9 -6 0 -6 -23 -2 -33 34 -17 57 15 22 48 29 58 13z"/> <path d="M1147 930 c-6 -16 -14 -30 -18 -30 -4 0 -7 -22 -7 -49 0 -54 -25 -100 -55 -101 -14 0 -16 5 -11 25 8 32 -4 95 -18 95 -5 0 -7 -7 -4 -16 4 -9 2 -13 -5 -8 -7 4 -10 -1 -7 -12 4 -23 -21 -56 -36 -47 -6 4 -5 -1 3 -10 18 -22 3 -22 -22 1 -19 16 -20 16 -14 -1 4 -11 1 -24 -7 -32 -12 -12 -16 -12 -26 0 -6 7 -19 11 -28 8 -14 -4 -14 -3 -3 5 8 6 20 8 27 5 8 -3 12 3 11 15 -1 17 -5 19 -20 10 -10 -5 -24 -7 -31 -5 -15 6 -41 -21 -51 -52 -4 -14 -2 -21 7 -22 23 -1 -33 -19 -71 -23 -102 -10 -134 -19 -138 -37 -3 -11 -10 -19 -15 -19 -5 0 -7 9 -3 19 4 15 1 19 -17 19 -13 1 -44 4 -70 7 -27 4 -48 2 -48 -3 0 -5 30 -23 68 -40 60 -28 133 -47 215 -56 54 -6 50 -26 -7 -28 -20 -1 -36 -4 -36 -8 0 -4 -19 -6 -42 -3 -108 10 -133 9 -150 -5 -10 -8 -26 -12 -38 -9 -11 3 -23 1 -26 -5 -6 -10 -76 -8 -84 3 -3 3 -16 9 -30 12 -24 6 -30 -1 -87 -106 -92 -168 -111 -210 -143 -305 -15 -48 -31 -95 -35 -105 -7 -16 11 -17 281 -17 267 0 287 1 259 16 -27 14 -48 14 -91 -3 -14 -5 -16 -2 -12 18 6 34 -13 52 -38 35 -20 -13 -104 -40 -109 -34 -12 12 31 89 67 120 204 176 229 201 216 210 -10 7 -10 8 2 6 8 -2 29 7 47 20 17 12 35 22 41 22 5 0 12 9 15 19 5 19 59 41 116 47 13 2 27 7 30 12 13 20 109 40 182 38 64 -2 79 -6 100 -25 13 -12 50 -41 82 -63 31 -23 57 -44 57 -49 0 -4 20 -17 45 -29 25 -12 52 -28 60 -36 11 -12 14 13 14 168 1 162 -1 186 -19 223 -26 53 -63 87 -122 111 -38 15 -47 23 -42 37 7 22 -36 89 -53 82 -7 -2 -15 0 -18 5 -11 18 -27 10 -38 -20z m-380 -282 c-3 -8 -6 -5 -6 6 -1 11 2 17 5 13 3 -3 4 -12 1 -19z m73 -3 c0 -2 -10 -9 -22 -15 -22 -11 -22 -10 -4 4 21 17 26 19 26 11z m-112 -15 c4 -1 -4 -5 -18 -9 -26 -8 -50 -4 -50 8 0 5 49 7 68 1z m52 -20 c-8 -5 -19 -10 -25 -10 -5 0 -3 5 5 10 8 5 20 10 25 10 6 0 3 -5 -5 -10z"/> <path d="M710 873 c-25 -8 -61 -12 -80 -10 -41 5 -80 -10 -80 -31 0 -22 66 -77 107 -90 44 -14 70 2 104 65 14 26 27 39 34 34 12 -10 45 -10 45 0 0 5 -37 26 -80 44 -3 1 -25 -4 -50 -12z m-77 -30 c-7 -2 -21 -2 -30 0 -10 3 -4 5 12 5 17 0 24 -2 18 -5z"/> <path d="M1220 366 c0 -2 8 -10 18 -17 15 -13 16 -12 3 4 -13 16 -21 21 -21 13z"/> <path d="M1400 272 c14 -11 29 -18 33 -15 12 7 -3 19 -33 28 l-25 8 25 -21z"/> <path d="M1358 250 c6 -8 12 -22 12 -31 0 -11 8 -16 26 -16 14 0 22 2 17 6 -4 3 -21 17 -38 31 -16 14 -24 18 -17 10z"/> <path d="M1270 230 c0 -3 18 -18 39 -32 37 -24 40 -25 38 -6 -1 11 -11 25 -22 31 -23 12 -55 17 -55 7z"/> <path d="M1250 205 c7 -9 15 -13 17 -11 7 7 -7 26 -19 26 -6 0 -6 -6 2 -15z"/> <path d="M1090 195 c0 -8 5 -15 10 -15 6 0 10 7 10 15 0 8 -4 15 -10 15 -5 0 -10 -7 -10 -15z"/> <path d="M1185 190 c3 -5 8 -10 11 -10 2 0 4 5 4 10 0 6 -5 10 -11 10 -5 0 -7 -4 -4 -10z"/> <path d="M1385 160 c10 -11 20 -18 23 -15 7 6 -18 35 -31 35 -5 0 -2 -9 8 -20z"/> <path d="M996 155 c-9 -26 -7 -32 5 -12 6 10 9 21 6 23 -2 3 -7 -2 -11 -11z"/> <path d="M1066 141 c-5 -8 0 -21 14 -35 21 -20 22 -20 12 -1 -5 11 -11 27 -14 35 -3 11 -6 11 -12 1z"/> <path d="M1240 145 c0 -3 25 -17 55 -31 54 -26 77 -44 56 -44 -6 0 -26 -13 -44 -30 -38 -33 -49 -37 -46 -17 3 22 -1 37 -9 37 -12 0 -9 -43 3 -52 6 -4 49 -8 98 -8 l87 0 0 61 c0 54 -2 60 -17 54 -37 -15 -53 -17 -53 -6 0 7 6 9 13 5 7 -4 7 -2 -2 7 -10 11 -15 11 -18 2 -7 -18 -28 -16 -65 7 -32 19 -58 26 -58 15z"/> <path d="M1011 98 c6 -15 18 -30 27 -33 22 -8 20 -3 -11 30 l-28 29 12 -26z"/> <path d="M1120 95 c0 -2 10 -10 23 -16 20 -11 21 -11 8 4 -13 16 -31 23 -31 12z"/> <path d="M950 66 c0 -2 7 -9 15 -16 13 -11 14 -10 9 4 -5 14 -24 23 -24 12z"/> <path d="M800 21 c-11 -22 -7 -24 23 -12 17 6 17 8 4 20 -13 10 -17 9 -27 -8z"/> <path d="M1060 28 c0 -9 5 -20 10 -23 13 -8 13 5 0 25 -8 13 -10 13 -10 -2z"/> <path d="M966 13 c-6 -14 -5 -15 5 -6 7 7 10 15 7 18 -3 3 -9 -2 -12 -12z"/> <path d="M1015 10 c3 -5 11 -10 16 -10 6 0 7 5 4 10 -3 6 -11 10 -16 10 -6 0 -7 -4 -4 -10z"/> </g> </svg></li>', 'after');
        this.menu = new Ext.menu.Menu({
            items: [{
                text: t("tinypng_config"),
                iconCls: "pimcore_icon_website",
                handler: this.config
            }],
            cls: "pimcore_navigation_flyout"
        });
        pimcore.layout.toolbar.prototype.tinypngMenu = this.menu;
    },

    pimcoreReady: function (params, broker) {
        var toolbar = pimcore.globalmanager.get("layout_toolbar");
        this.navEl.on("mousedown", toolbar.showSubMenu.bind(toolbar.tinypngMenu));
        pimcore.plugin.broker.fireEvent("tinypngMenuReady", toolbar.tinypngMenu);
    },

    config: function () {

        try {
            pimcore.globalmanager.get("zephis_tinypng_config").activate();
        } catch (e) {
            pimcore.globalmanager.add("zephis_tinypng_config", new zephis.tinypng.config());
        }
    },
});

var TinyPngBundlePlugin = new pimcore.plugin.TinyPngBundle();
